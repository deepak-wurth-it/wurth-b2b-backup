{"version":3,"sources":["../../ts/src/in-page/Page.ts"],"names":["Page","config","selectIndex","index","activeIndex","identifier","request","xhr","abort","searchQuery","result","ts","Date","getTime","loading","ajax","url","dataType","type","data","q","store_id","storeId","cat","limit","page","buckets","filters","success","time","visible","observable","sendRequest","debounce","delay","searchBarView","SearchBar","query","subscribe","toggleClass","document","on","e","key"],"mappings":";;MAMaA,I,GAaT,cAAYC,MAAZ,EAA4B;AAAA;;AAAA;;AAAA,SA8B5BC,WA9B4B,GA8Bd,UAACC,KAAD,EAAwB;AAClC,MAAA,KAAI,CAACC,WAAL,CAAiBD,KAAK,CAACE,UAAvB;AACH,KAhC2B;;AAAA,SAkC5BC,OAlC4B,GAkClB,YAAM;AAAA;;AACZ,mBAAA,KAAI,CAACC,GAAL,+BAAUC,KAAV;;AAEA,UAAI,KAAI,CAACC,WAAL,OAAuB,EAA3B,EAA+B;AAC3B,QAAA,KAAI,CAACC,MAAL,CAAY,IAAZ;;AACA;AACH;;AAED,UAAMC,EAAE,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAX;;AAEA,MAAA,KAAI,CAACC,OAAL,CAAa,IAAb;;AAEA,MAAA,KAAI,CAACP,GAAL,GAAW,QAAEQ,IAAF,CAAO;AACdC,QAAAA,GAAG,EAAO,KAAI,CAACf,MAAL,CAAYe,GADR;AAEdC,QAAAA,QAAQ,EAAE,MAFI;AAGdC,QAAAA,IAAI,EAAM,KAHI;AAIdC,QAAAA,IAAI,EAAM;AACNC,UAAAA,CAAC,EAAS,KAAI,CAACX,WAAL,EADJ;AAENY,UAAAA,QAAQ,EAAE,KAAI,CAACpB,MAAL,CAAYqB,OAFhB;AAGNC,UAAAA,GAAG,EAAO,KAHJ;AAINC,UAAAA,KAAK,EAAK,EAJJ;AAKNC,UAAAA,IAAI,EAAM,CALJ;AAMNC,UAAAA,OAAO,EAAG,CAAE,cAAF,CANJ;AAONC,UAAAA,OAAO,EAAG;AAAE,4BAAgB;AAAlB;AAPJ,SAJI;AAadC,QAAAA,OAAO,EAAG,iBAACT,IAAD,EAAkB;AACxB,UAAA,KAAI,CAACL,OAAL,CAAa,KAAb;;AACA,UAAA,KAAI,CAACJ,MAAL,CAAYS,IAAZ;;AACA,UAAA,KAAI,CAACU,IAAL,CAAU,CAAC,IAAIjB,IAAJ,GAAWC,OAAX,KAAuBF,EAAxB,IAA8B,IAAxC;AACH;AAjBa,OAAP,CAAX;AAmBH,KAjE2B;;AACxB,SAAKV,MAAL,GAAcA,MAAd;AACA,SAAK6B,OAAL,GAAe,UAAGC,UAAH,CAAc,KAAd,CAAf;AACA,SAAKjB,OAAL,GAAe,UAAGiB,UAAH,CAAc,KAAd,CAAf;AACA,SAAKtB,WAAL,GAAmB,UAAGsB,UAAH,CAAc,EAAd,CAAnB;AACA,SAAK3B,WAAL,GAAmB,UAAG2B,UAAH,CAAc,yBAAd,CAAnB;AACA,SAAKC,WAAL,GAAmB,YAAEC,QAAF,CAAW,KAAK3B,OAAhB,EAAyBL,MAAM,CAACiC,KAAhC,CAAnB;AACA,SAAK3B,GAAL,GAAW,IAAX;AACA,SAAKG,MAAL,GAAc,UAAGqB,UAAH,CAAc,IAAd,CAAd;AACA,SAAKF,IAAL,GAAY,UAAGE,UAAH,CAAc,IAAd,CAAZ;AAEA,SAAKI,aAAL,GAAqB,IAAIC,oBAAJ,CAAc;AAC/BC,MAAAA,KAAK,EAAI,KAAK5B,WADiB;AAE/BqB,MAAAA,OAAO,EAAE,KAAKA;AAFiB,KAAd,CAArB;AAMA,SAAKA,OAAL,CAAaQ,SAAb,CAAuB,UAAAR,OAAO,EAAI;AAC9B,mBAAE,MAAF,EAAUS,WAAV,CAAsB,WAAtB,EAAmCT,OAAnC;AACH,KAFD;AAIA,iBAAEU,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,UAAAC,CAAC,EAAI;AACzB,UAAIA,CAAC,CAACC,GAAF,KAAU,QAAd,EAAwB;AACpB,QAAA,KAAI,CAAClC,WAAL,MAAsB,EAAtB,IAA4B,KAAI,CAACqB,OAAL,CAAa,KAAb,CAA5B;AACH;AACJ,KAJD;AAMA,SAAKrB,WAAL,CAAiB6B,SAAjB,CAA2B,KAAKN,WAAhC;AACH,G","sourcesContent":["import { Config, IndexResult, Result } from \"../types\"\nimport _ from \"underscore\"\nimport ko from \"knockout\"\nimport $ from \"jquery\"\nimport { SearchBar } from \"./SearchBar\"\n\nexport class Page {\n    visible: KnockoutObservable<boolean>\n    loading: KnockoutObservable<boolean>\n    searchQuery: KnockoutObservable<string>\n    sendRequest: () => void\n    xhr: JQueryXHR | null\n    config: Config\n    result: KnockoutObservable<Result | null>\n    time: KnockoutObservable<number | null>\n    activeIndex: KnockoutObservable<string>\n\n    searchBarView: SearchBar\n\n    constructor(config: Config) {\n        this.config = config\n        this.visible = ko.observable(false)\n        this.loading = ko.observable(false)\n        this.searchQuery = ko.observable(\"\")\n        this.activeIndex = ko.observable(\"magento_catalog_product\")\n        this.sendRequest = _.debounce(this.request, config.delay)\n        this.xhr = null\n        this.result = ko.observable(null)\n        this.time = ko.observable(null)\n\n        this.searchBarView = new SearchBar({\n            query:   this.searchQuery,\n            visible: this.visible,\n        })\n\n\n        this.visible.subscribe(visible => {\n            $(\"html\").toggleClass(\"mstInPage\", visible)\n        })\n\n        $(document).on(\"keyup\", e => {\n            if (e.key === \"Escape\") {\n                this.searchQuery() == \"\" && this.visible(false)\n            }\n        })\n\n        this.searchQuery.subscribe(this.sendRequest)\n    }\n\n    selectIndex = (index: IndexResult) => {\n        this.activeIndex(index.identifier)\n    }\n\n    request = () => {\n        this.xhr?.abort()\n\n        if (this.searchQuery() === \"\") {\n            this.result(null)\n            return\n        }\n\n        const ts = new Date().getTime()\n\n        this.loading(true)\n\n        this.xhr = $.ajax({\n            url:      this.config.url,\n            dataType: \"json\",\n            type:     \"GET\",\n            data:     {\n                q:        this.searchQuery(),\n                store_id: this.config.storeId,\n                cat:      false,\n                limit:    30,\n                page:     1,\n                buckets:  [ \"category_ids\" ],\n                filters:  { \"category_ids\": 21 },\n            },\n            success:  (data: Result) => {\n                this.loading(false)\n                this.result(data)\n                this.time((new Date().getTime() - ts) / 1000)\n            },\n        })\n    }\n}\n"],"file":"Page.js"}