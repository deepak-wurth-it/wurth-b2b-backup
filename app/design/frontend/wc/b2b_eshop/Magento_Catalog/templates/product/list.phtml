<?php
/**
 * Copyright Â© 2016 Magento. All rights reserved.
 * See COPYING.txt for license details.
 */

use Magento\Framework\App\Action\Action;

// @codingStandardsIgnoreFile

?>
<?php
/**
 * Product list template
 *
 * @var $block \Magento\Catalog\Block\Product\ListProduct
 */
?>
<?php
/** @var \Magento\Catalog\Helper\Output $_helper */
$_helper = $_outputHelper = $block->getData('outputHelper');

$objectmanager = \Magento\Framework\App\ObjectManager::getInstance();


?>
<!-- For Category -->
<?php $level = $block->getLayer()->getCurrentCategory()->getLevel(); ?>
<?php //die($level);?>
<?php $ProductCount = $block->getLayer()->getCurrentCategory()->getProductCollection()->Count(); ?>
<?php $catId = $block->getLayer()->getCurrentCategory()->getId(); ?>
<?php $catName = $block->getLayer()->getCurrentCategory()->getName(); ?>
<?php $currentCat = $block->getLayer()->getCurrentCategory(); ?>
<?php $subcategories = []; ?>
<?php $subcategories = $block->getCategoryChildrenData($catId); ?>
<!-- End For Category -->
<!-- For Product -->
<?php
$viewMode = 'grid';
$kk = "912 814185";
$pid= [];
$imageDisplayArea = 'category_page_grid';
$showDescription = false;
$templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
$pos = $block->getPositioned();
$product=false;
?>
<!-- <div data-mage-init='{"plp":{}}' ></div> -->
<!-- End For Product -->
<?php if( $level != 5 ) { ?>
    <?= $block->getToolbarHtml() ?>
    <?= $block->getAdditionalHtml() ?>

    <div class="products wrapper grid products-grid">
        <ol class="products list items product-items productListingwrapper">
            <?php foreach ($subcategories as $subcategory): ?>
                <?php $productCount = $subcategory->getProductCollection()->getSize(); ?>
                <?php $subcategory = $block->getCategoryData($subcategory->getId()); ?>
                <?php if ($subcategory->hasChildren() || $productCount > 1): ?>
                    <li class="item product product-item">
                        <div class="product-item-info">
                            <?php if ($_imgUrl = $subcategory->getImageUrl()): ?>
                                <a href="<?= $subcategory->getUrl() ?>" class="product photo product-item-photo">
            <span class="product-image-container">
            <?php $_imgHtml = '<img src="' . $_imgUrl . '" />'; ?>
            <?php echo $_imgHtml = $_outputHelper->categoryAttribute($subcategory, $_imgHtml, 'image'); ?>
            </span>
                                </a>
                            <?php endif; ?>
                            <div class="product details product-item-details">
                                <a href="<?= $subcategory->getUrl() ?>" class="product photo product-item-photo">
            <span class="product-image-container">
            <?php $_imgHtml = '<img src="' . $_imgUrl . '" />'; ?>
            <?php echo $_imgHtml = $_outputHelper->categoryAttribute($subcategory, $_imgHtml, 'image'); ?>
            </span>
                                </a>
                                <strong class="product name product-item-name PlpItemName">
                                    <a class="product-item-link"
                                       href="<?= $subcategory->getUrl() ?>"><?= $subcategory->getName() ?></a>
                                </strong>
                                <?php if ($level > 3 && $productCount > 1) { ?>
                                    <p class="price-box">
                                        <label>
                                            <span class="startFrom">Start from </span></span><span class="price">1,816.17 HRK</span>
                                    </p>
                                    <p class="view-stock"><a href="#" class="view-stock">Please select single product to
                                            view stock</a></p>
                                    <p class="variation-box"><label><?php echo $productCount; ?>
                                            variations </label>
                                    </p>
                                    <p class="variation-buttom"><a href="<?= $subcategory->getUrl() ?>"><label> Show variations</label></a></p>
                                <?php } ?>
                                <?php if ($level > 3 && $productCount == 1) { ?>
                                    <p class="quantity-available">Quantity available immediately: 90</p>
                                    <p class="price-box"><span class="price">1,816.17 HRK</span></p>
                                    <p class="variation-box"><label> -120 + 100 pc</label></p>
                                    <p class="variation-buttom"><label> Dodaju Kosaricu</label></p>
                                    <p>Count <?php echo $subcategory->getProductCollection()->getSize();; ?></p>
                                <?php } ?>
                            </div>
                        </div>
                    </li>
                <?php endif; ?>
                <?php if (!$subcategory->hasChildren() &&  $productCount == 1): ?>
                    <?php 

                       $products = $subcategory->getProductCollection()->addAttributeToSelect('*');    

                    ?>
                    <?php foreach ($products as $_product): ?>
                     

                        <?php  $ProductCode = $_product->getProductCode(); ?>
                  
                        <?php $product = true; ?>
                        <li class="item product product-item">
                            <div class="product-item-info"
                                 id="product-item-info_<?= /* @noEscape */ $_product->getId() ?>"
                                 data-container="product-<?= /* @noEscape */ $viewMode ?>">
                                <?php if($ProductCode){ ?>
                                <?php $pid[ $_product->getSku()][] = '"'.$ProductCode.'"'; ?> 
                                <?php $pid[ $_product->getSku()][] = '"1"'; ?> 
                                <?php } ?>

                                <?php
                                $productImage = $block->getImage($_product, $imageDisplayArea);
                                if ($pos != null) {
                                    $position = 'left:' . $productImage->getWidth() . 'px;'
                                        . 'top:' . $productImage->getHeight() . 'px;';
                                }

                                ?>
                                <?php // Product Image
                                $product = $objectmanager ->create('Magento\Catalog\Model\Product')->load($_product->getId());
                                $abstractProductBlock = $block->getLayout()->createBlock('\Magento\Catalog\Block\Product\AbstractProduct');
                                $productimages = $product->getMediaGalleryImages();

                                ?>
                                <a href="<?= $escaper->escapeUrl($subcategory->getUrl()); ?>"
                                   class="product photo product-item-photo"
                                   tabindex="-1">
                                    <?php
                                    foreach($productimages as $productimage)
                                    {
                                        echo "<img src = ".$productimage['url']. " />";
                                        break;
                                    } ?>
                                </a>
                                <div class="product details product-item-details">
                                    <?php $_productNameStripped = $block->stripTags($_product->getName(), null, true); ?>
                                    <strong class="product name product-item-name PlpItemName">
                                        <a class="product-item-link"
                                           href="<?= $escaper->escapeUrl($subcategory->getUrl()) ?>">
                                            <?php echo $product->getName(); ?>
                                        </a>
                                    </strong>
                                    <?php $ProductCode = str_replace(' ', '', $ProductCode); ?>
                                    <span class="price" id="price_<?php echo $ProductCode; ?>"> </span>
                                    <span class="stock" id="stock_<?php echo $ProductCode; ?>"> </span>

                                    <div class="product-item-inner">
                                        <div class="product actions product-item-actions">
                                            <div class="actions-primary">
                                                <?php if ($_product->isSaleable()):?>
                                                    <?php $postParams = $block->getAddToCartPostParams($_product); ?>
                                                    <form data-role="tocart-form"
                                                          data-product-sku="<?= $escaper->escapeHtml($_product->getSku()) ?>"
                                                          action="<?= $escaper->escapeUrl($postParams['action']) ?>"
                                                          method="post">
                                                        <input type="hidden"
                                                               name="product"
                                                               value="<?= /* @noEscape */ $postParams['data']['product'] ?>">
                                                        <input type="hidden"
                                                               name="<?= /* @noEscape */ Action::PARAM_NAME_URL_ENCODED ?>"
                                                               value="<?=
                                                               /* @noEscape */ $postParams['data'][Action::PARAM_NAME_URL_ENCODED]
                                                               ?>">
                                                        <?= $block->getBlockHtml('formkey') ?>
                                                        <!--  --------------- -->
                                                        <div class="box-tocart">
                                                            <div class="fieldset productFieldset">
                                                                <div class="field qty">
                                                                    <!-- <label class="label" for="qty"><span><?php /* @escapeNotVerified */
                                                                    //echo __('Qty') ?></span></label> -->
                                                                    <div class="control-qty-cart">
                                                                        <span class=" icon-interface-minus quantity-controls quantity-minus"></span>
                                                                        <input type="number" name="qty" id="qty" maxlength="12" value="1" title="<?php /* @escapeNotVerified */
                                                                        echo __('Qty') ?>" class="qty-default input-text qty"
                                                                               data-validate="<?php echo $block->escapeHtml(json_encode($block->getQuantityValidators())) ?>"
                                                                        />
                                                                        <span class="quantity-controls quantity-plus icon-interface-plus"></span>

                                                                    </div>

                                                                </div>
                                                                <div class="pkgCount">
                                                                    <select>
                                                                        <option> 100 PC</option>
                                                                        <option> 100 PC</option>
                                                                        <option> 100 PC</option>
                                                                        <option> 100 PC</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!--  --------------- -->
                                                        <div class="product-actions">
                                                <button type="submit"
                                                        title="<?= $escaper->escapeHtmlAttr(__('Add to Cart')) ?>"
                                                        class="action tocart primary variation-buttom"
                                                        disabled>
                                                    <span><?= $escaper->escapeHtml(__('Add to Cart')) ?></span>
                                                </button>
                                                <div data-role="add-to-links" class="actions-secondary">
                                                    <?php if ($addToBlock = $block->getChildBlock('addto')): ?>
                                                        <?= $addToBlock->setProduct($_product)->getChildHtml() ?>
                                                    <?php endif; ?>
                                                </div>
                                            </div>
                                          </form>
                                                <?php else:?>
                                                    <?php if ($_product->isAvailable()):?>
                                                        <div class="stock available">
                                                            <span><?= $escaper->escapeHtml(__('In stock')) ?></span>
                                                        </div>
                                                    <?php else:?>
                                                        <div class="stock unavailable">
                                                            <span><?= $escaper->escapeHtml(__('Out of stock')) ?></span>
                                                        </div>
                                                    <?php endif; ?>
                                                <?php endif; ?>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    <?php endforeach; ?>
                <?php endif; ?>
            <?php endforeach; ?>
        </ol>
    </div>
    <?= $block->getToolbarHtml() ?>
    <?php if (!$block->isRedirectToCartEnabled() && $product): ?>
        <script type="text/x-magento-init">
   {
       "[data-role=tocart-form], .form.map.checkout": {
           "catalogAddToCart": {
               "product_sku": "<?= $escaper->escapeJs($_product->getSku()) ?>"
           }
           
       }
   }
</script>
<?php $pid_json = json_encode($pid) ?>
<?php echo $pid_json ?>
<script type="text/x-magento-init">
    
        {
            "body" : {
                    "plp": {
                            "listPids": <?php echo $pid_json ?>
                    }
            }
        }
    </script>
    <?php endif; ?>
    <script type="text/javascript">
        require([
            'jquery'
        ], function ($) {
            $('.quantity-plus').click(function () {
                // $('.qty-default').val(Number($('.qty-default').val()) + 1);
                var currentQTY = parseInt($(this).parent().parent().find(".qty-default").val());
                currentQTY = currentQTY + 1;
                $(this).parent().parent().find(".qty-default").val(currentQTY);
            });

            $('.quantity-minus').click(function () {
                // var value = Number($('.qty-default').val()) - 1;
                var currentQTY = parseInt($(this).parent().parent().find(".qty-default").val());
                currentQTY = currentQTY - 1;
                if (currentQTY > 0) {
                    $(this).parent().parent().find(".qty-default").val(currentQTY);
                }
            });

            
        });
    </script>
<?php } ?>

<?php if($level == 5 ){ ?>
    <?php 
    $objectManager = \Magento\Framework\App\ObjectManager::getInstance();
    $customerSession = $objectManager->get('Magento\Customer\Model\Session');
   $logedIn = $customerSession->isLoggedIn();
  ?>

 <div class="row levelFive">
   <div class="col-sm-6">
      <div class="container">  
      <div class="thumbnail sliderThubnail">      
         <img src="http://m2.wc.b2b.com/media/catalog/product/cache/0dfee5ff3991729dd0bd32f4d3803aa6/1/2/1234785_1.jpg" class="pdp-thumbnail" alt="Cinque Terre" width="304" height="236"> 
      </div>
      </div>
   </div>
   <div class="col-sm-6">
      <div class="container">
         <div class="static-content">
             <div class="pHead">BUSILICE-ODVIJACI - AKUMULLATORSKI</div>
            <div class="pdAku">AKU BUSILICA ODVIJAC-ABS 12 COMPACT-2X2,O AH</div>
            <span class="hrline"></span>
            <div class="pdversion">Available in 2 version</div>
            <div class="pdvariants"><button type="submit" class="itemAdd">Show variants</button></div>
            <span class="hrline"></span>
            <div class="col-md-6 more-info-block">
               <div class="moreInfo">Need More Information?</div>
               <span class="phoneEmail">Contact us by phone or email?</span>
               <div><span class="icon-com-phone-a"></span> <span class="iphone-outline">Phone 0800 4260</span></div>
               <div><span class="icon-wuerth-e-mail"></span><span class="email-outline">Email wuert@wuerth.com.hr</span></div>
            </div>
            <div class="pdrepbug"><button type="submit" class="itembug"><span class="icon-web-warning"></span> Report a bug</button></div>
            <div class="col-md-6 social-block">
               <ul>
                  <li><a href="#!" role="button"><span class="icon-whatsapp"></span></a></li>
                  <li><a href="#!" role="button"><span class="icon-call"></span></a></li>
                  <li><a href="#!" role="button"><span class="icon-linkdin"></span></a></li>
                  <li><a href="#!" role="button"><span class="icon-facebook"></span></a></li>
                  <li><a href="#!" role="button"><span class="icon-youtube"></span></a></li>
               </ul>
            </div>
         </div>
      </div>
   </div>   
</div>

<!-- start-->
<?php if(true===true){ ?>
<div class="row attWrappFifth">
   <div class="col-md">
      <div class="container">
  <div class="execution">Executions</div>
  <div class="attTitle">
    <span class="attrow">Item No.</span>
    <span class="attrow">Item Name</span>
    <span class="attrow">Accumuulator / battery ...</span>
    <span class="attrow">Accumuulator / battery ...</span>
    <span class="attrow">Nominal voltage</span>
    <span class="attrow">Number </span>
    <span class="attrow">VE</span>
    <span class="attrow">Price PU</span>
  </div>
<?php if($currentCat->getProductCollection()->getSize() > 0 ){ ?>  
 <?php $level5Collection =  $currentCat->getProductCollection()->addAttributeToSelect('*'); ?> 
<?php foreach($level5Collection as $product) { ?>  
  <div class="accordion">
    <span class="attrow itemno"><?php echo $product->getSku(); ?></span>
    <span class="attrow itemname"><?php echo $product->getName(); ?></span>
    <span class="attrow pieces">2 PiECES</span>
    <span class="attrow ah">2 Ah</span>
    <span class="attrow vdc">18 V / DC</span>
    <div class="boxcontaner <?= (($logedIn ?'logdIn':'')); ?>">
    <span class="attrow <?= (($logedIn ?'logdIn':'')); ?>">
      <div class="qty-field">
        <div id="79-dec" class="decreaseQty icon-interface-minus"></div>
        <input id="cart-79-qty" name="cart[79][qty]" data-cart-item-id="Test product" value="1" type="number" size="4" step="any" title="Qty" class="input-text qty" data-validate="{required:true,'validate-greater-than-zero':true}" data-role="cart-item-qty">
        <div id="79-upt" class="increaseQty icon-interface-plus"></div>
      </div>
    </span>
    <span class="attrow pc <?= (($logedIn ?'logdIn':'')); ?>">
      <div class="veCount <?= (($logedIn ?'logdIn':'')); ?>">
        <select>
          <option> 100 PC </option>
          <option> 100 PC </option>
          <option> 100 PC </option>
        </select>
      </div>
      <?php if($customerSession->isLoggedIn()) { ?> <div class="itemboxwraper <?= (($logedIn ?'logdIn top':'')); ?>"><span class="itembox <?= (($logedIn ?'logdIn top':'')); ?>"></span><span class="deliveryday <?= (($logedIn ?'logdIn top':'')); ?>">1</span> </div> <?php } ?>
    </span>
</div>
    <span class="attrow loginprice <?= (($logedIn ?'logdIn':'')); ?>"><?php if($customerSession->isLoggedIn()) { ?> 2,421.56 - 25% = 1,816.17 HRK/COM <div class="itemboxwrapp"><span class="redbox"></span><span class="redvan"></span><span class="deliveryday">10-14</span> </div> <?php } else { ?> Please log in to see prices. <?php } ?></span>
    <span class="attrow bluecol">
      <!-- <a href="http://m2.wc.b2b.com/test-product.html" class="carticon"></a> -->
      <div class="actions-primary">
      <?php if ($product->isSaleable()):?>
      <?php $postParams = $block->getAddToCartPostParams($product); ?>
        <form data-role="tocart-form"
              data-product-sku="<?= $escaper->escapeHtml($product->getSku()) ?>"
              action="<?= $escaper->escapeUrl($postParams['action']) ?>"
              method="post">
            <input type="hidden"
                    name="product"
                    value="<?= /* @noEscape */ $postParams['data']['product'] ?>">
            <input type="hidden"
                    name="<?= /* @noEscape */ Action::PARAM_NAME_URL_ENCODED ?>"
                    value="<?=
                    /* @noEscape */ $postParams['data'][Action::PARAM_NAME_URL_ENCODED]
                    ?>">
            <?= $block->getBlockHtml('formkey') ?>
            <button type="submit"
                    title="<?= $escaper->escapeHtmlAttr(__('Add to Cart')) ?>"
                    class="action tocart primary carticon"
                    disabled>
               <!-- <span><?= $escaper->escapeHtml(__('Add to Cart')) ?></span>-->
            </button>
        </form>
      </div>
      <?php endif;  ?>
    </span>
  </div>
  
  <div class="expendRow"></div>
  <div class="panel">
    <div class="row">
      <div class="col-sm-4">
        <div class="container">
          <img src="http://m2.wc.b2b.com/media/catalog/product/cache/0dfee5ff3991729dd0bd32f4d3803aa6/1/2/1234785_1.jpg" class="pdp-thumbnail" alt="Cinque Terre" width="304" height="236">
        </div>
      </div>
      <div class="col-sm-8">
        <div class="container">
          <div class="pdpvarcont">Cordless drill screwdriver ABS 18 BASIC BOSHRBR-AKKU-(ABS 18 BASIC-75J) - 2X2, 0AH MASTER M-CUBE </div>
          <div class="pdpItemNo"> 5701408004 Item No.</div>
          <span class="hrline"></span>
          <div class="wurthCat">
            <div class="catTitle"> Wurth Catalog (2)</div>
            <ul>
              <li>
                <span class="pdficon"></span> Catalogue page as PDF1
              </li>
              <li>
                <span class="flipicon"></span> Flip Pdf
              </li>
            </ul>
          </div>
          <span class="hrline"></span>
          <div class="catTitle">Technical information</div>
          <table class="tables table-hovers">
            <tbody>
              <tr>
                <td>azivni napon</td>
                <td>12 V/DC</td>
              </tr>
              <tr>
                <td>Broj okretaja u praznom hodu 1./2. brzina, min/max</td>
                <td>0-400/0-1500 U/min (rpm)</td>
              </tr>
              <tr>
                <td>Okretni moment tvrdi/mekani maks.</td>
                <td>32/19 Nm</td>
              </tr>
              <tr>
                <td>Zatezno podrucje brzoztezne glave za busenje min./maks.</td>
                <td>0,8-10 mm</td>
              </tr>
              <tr>
                <td>Zatezno podrucje brzoztezne glave za busenje min./maks.</td>
                <td>0,8-10 mm</td>
              </tr>
              <tr>
                <td>Zatezno podrucje brzoztezne glave za busenje min./maks.</td>
                <td>0,8-10 mm</td>
              </tr>
              <tr>
                <td>Zatezno podrucje brzoztezne glave za busenje min./maks.</td>
                <td>0,8-10 mm</td>
              </tr>
              <tr>
                <td>Zatezno podrucje brzoztezne glave za busenje min./maks.</td>
                <td>0,8-10 mm</td>
              </tr>
              <tr>
                <td>visina</td>
                <td>215 mm</td>
              </tr>
            </tbody>
          </table>
          <div class="allprowrapp">
            <button type="submit" class="allpro"> See all product details</button>
          </div>
        </div>
      </div>
    </div>
  </div>
<?php } ?>
<?php } ?>    
</div>
</div>
<?php } ?>
<!-- End --->

    <script>
    // <![CDATA[
        require([
            'jquery'
        ], function ($) {
            $('.sidebar-main').remove();
            $('.sidebar').remove();
            $('.category-view').remove();
            $('.page-title-wrapper').remove();
            $('.page-layout-2columns-left .column.main').width("100%"); //to increase width of page
            
            window.addEventListener('resize', function(event){
             if ( $(window).width() > 990) {     
                $('.page-layout-2columns-left .column.main').width("100%"); //to increase width of page
                }
                else {
                    $('.page-layout-2columns-left .column.main').width("70%"); //to increase width of page  
                }
            });
            
   $(".itemAdd").click(function() {
       $('html,body').animate({
           scrollTop: $(".execution").offset().top},
           'slow');
   });
        });
        // ]]>

   var acc = document.getElementsByClassName("expendRow");
   var i;   
   for (i = 0; i < acc.length; i++) {
     acc[i].addEventListener("click", function() {
       this.classList.toggle("active");
       var panel = this.nextElementSibling;
       if (panel.style.maxHeight) {
         panel.style.maxHeight = null;
       } else {
         panel.style.maxHeight = panel.scrollHeight + "px";
       } 
     });
   }
   
    </script>
      <script type="text/x-magento-init">
   {
       "[data-role=tocart-form], .form.map.checkout": {
           "catalogAddToCart": {
               "product_sku": "<?= $escaper->escapeJs($product->getSku()) ?>"
           }
           
       }
   }
</script>

<?php } ?>
